# Best way to integrate this is adding the following line to your VirtualHost definition:
# Include /path/to/website/.htdev
#
# WARNING:
# If you do not include this file as mentioned above and rewrite rules do not work for you,
# you might need to locally remove leading slashes from the rewrite rules.
# Including as mentioned above should work in almost every case.

# Error docs
ErrorDocument 401 /app.php/401/
ErrorDocument 403 /app.php/403/
ErrorDocument 404 /app.php/404/
ErrorDocument 412 /app.php/412/
ErrorDocument 500 /app.php/500/

# The real stuff
RewriteEngine On

# Block .git access (including subdirectories)
RewriteRule "^(.*/)?\.git/" - [F,L]

# Taking the board down for maintenance
#Options +FollowSymlinks
#RewriteCond %{REQUEST_URI} !/maintenance.html$
#RewriteCond %{REMOTE_HOST} !^69\.115\.204\.50
#RewriteCond %{REQUEST_URI} !/app_dev.php$
#RewriteRule $ /maintenance.html? [R=302,L]

# This page can be used to sent abusers to. This specific rewritecond is from an attack a while back.
RewriteCond %{REQUEST_URI} ^/community/ucp.php$
RewriteCond %{QUERY_STRING} ^i=pm&mode=compose&u=&sid=$
RewriteCond %{REQUEST_METHOD} ^GET$ [OR]
RewriteCond %{REQUEST_METHOD} ^HEAD$
RewriteCond %{HTTP_REFERER} ^$
RewriteRule .* /abuse_block.php [L]

# Redirects from Website 3.0 to 4.0

# Site 3.0 General Redirects
RewriteRule ^/support/spam/$ /community/viewtopic.php?f=46&t=2122696 [R=301,L]
RewriteRule ^/support/scam-warning/$ /community/viewtopic.php?f=14&t=2111378 [R=301,L]
RewriteRule ^/about\.php$ /about/ [R=301,L]
RewriteRule ^/about/map\.php$ /about/map/ [R=301,L]
RewriteRule ^/about/ads/(index\.php|bid\.php)?$ /about/advertise/ [R=301,L]
#RewriteRule ^/about/contact_us\.php$ /about/contact/ [R=301,L]
RewriteRule ^/downloads\.php$ /downloads/ [R=301,L]
RewriteRule ^/downloads/license\.php$ /downloads/license/ [R=301,L]
RewriteRule ^/downloads/legacy\.php$ /downloads/ [R=301,L]
RewriteRule ^/downloads/development\.php$ /downloads/ [R=301,L]
RewriteRule ^/downloads/olympus\.php$ /downloads/ [R=301,L]
RewriteRule ^/downloads/license/$ /downloads/license.php$1 [QSA]
RewriteRule ^/files/archive/(.*)$ http://download.phpbb.com/pub/release/3.0/$1 [R=301,L]
RewriteRule ^/features\.php$ /about/features/ [R=301,L]
RewriteRule ^/shop/bear\.php$ /shop/ [R=301,L]
RewriteCond %{QUERY_STRING} ^b=([0-9]+)$
RewriteRule ^/bugs/viewreport\.php$ /bugs/all/ticket.php?ticket_id=%1
RewriteRule ^/bugs/stats\.php$ /bugs/all/statistics.php [R=301,QSA]
RewriteCond %{IS_SUBREQ} !^true$
RewriteRule ^/(bugs|security|incidents)/{0,1}$ /trackers/index.php [QSA]
RewriteRule ^/(bugs|security|incidents)/([a-z0-9]+)/{0,1}$ /trackers/tickets.php?project=$2 [QSA]
RewriteRule ^/(bugs|security|incidents)/([a-z0-9]+)/([0-9]+)/{0,1}$ /trackers/ticket.php?project=$2&ticket_id=$3 [QSA]
RewriteRule ^/(bugs|security|incidents)/([a-z0-9]+)/([a-z0-9\._]+)/{0,1}$ /trackers/$3?project=$2 [QSA]
RewriteRule ^/languages/([0-9]{1}\.[0-9]{1})/{0,1}(.+) languages/$2?v=$1 [QSA]
RewriteRule ^/languages/([a-z0-9]{3,20})/{0,1}$ languages/detail.php?pack=$1 [QSA]
RewriteRule ^/kb/article/moving-your-phpbb3-forum-to-a-new-host-using-phpmyadmin/$ /kb/article/transferring-your-board-to-a-new-host-or-domain/ [R=301,L]
RewriteRule ^/libertyvasion/([A-Za-z0-9\-_]+)/$ /libertyvasion/index.php?page=$1 [QSA]
RewriteRule ^/feeds/(atom|rss){1}/{0,1}$ /feeds/index.php?t=$1 [QSA]
RewriteRule ^/mods/jobs /mods/volunteer [R=301,QSA]
RewriteRule ^/mods/modx/utilities /mods/utilities [R=301,QSA]
RewriteRule ^/mods/modx/update.php /mods/modx/update/ [R=301,QSA]
RewriteRule ^/mods/policies/3.0.php /mods/policies/general.php [R=301,QSA]
RewriteRule ^/development/get-involved/ /get-involved/ [R=301,QSA]
RewriteRule ^/mods/policies/general.php /mods/rules-and-policies/db/general/ [R=301,QSA]
RewriteRule ^/mods/policies/instadeny.php /mods/rules-and-policies/db/insta-deny/ [R=301,QSA]
RewriteRule ^/mods/policies/repack.php /mods/rules-and-policies/db/repack/ [R=301,QSA]
RewriteRule ^/mods/policies/pdf/general.pdf /mods/rules-and-policies/db/general.pdf [R=301,QSA]
RewriteRule ^/mods/policies/pdf/instadeny.pdf /mods/rules-and-policies/db/insta-deny.pdf [R=301,QSA]
RewriteRule ^/mods/policies/pdf/repack.pdf /mods/rules-and-policies/db/repack.pdf [R=301,QSA]
RewriteRule ^/mods/policies/ /mods/rules-and-policies/ [R=301,QSA]
RewriteRule ^/blog/(.*)$ http://blog.phpbb.com/$1 [R=301]
RewriteCond %{QUERY_STRING} ^style=([0-9]+)$
RewriteRule ^/styles/demo/3.0/index\.php$ /styles/demo/3.0/index.php?style_id=%1 [R=301]
RewriteCond %{QUERY_STRING} ^style=([0-9]+)$
RewriteRule ^/styles/demo/3.0/?$ /styles/demo/3.0/?style_id=%1 [R=301]
RewriteRule ^/support/code-changes/ http://area51.phpbb.com/code-changes/ [R=301]

<IfModule mod_expires.c>
	<FilesMatch "\.(jpe?g|png|gif|js|css)$">
		ExpiresActive On
		ExpiresDefault "access plus 6 hours"
	</FilesMatch>
</IfModule>

# Site 2.0 to Site 3.0 Redirects
RewriteCond %{QUERY_STRING} ^c=7$
RewriteRule ^/phpBB/(index\.php)?$ /community/viewforum.php?f=47 [R=301]
RewriteCond %{QUERY_STRING} ^c=1$
RewriteRule ^/phpBB/(index\.php)?$ /community/viewforum.php?f=48 [R=301]
RewriteCond %{QUERY_STRING} ^c=9$
RewriteRule ^/phpBB/(index\.php)?$ /community/viewforum.php?f=49 [R=301]
RewriteCond %{QUERY_STRING} ^c=4$
RewriteRule ^/phpBB/(index\.php)?$ /community/viewforum.php?f=50 [R=301]
RewriteCond %{QUERY_STRING} ^c=6$
RewriteRule ^/phpBB/(index\.php)?$ /community/viewforum.php?f=51 [R=301]
RewriteCond %{QUERY_STRING} ^c=2$
RewriteRule ^/phpBB/(index\.php)?$ /community/viewforum.php?f=52 [R=301]
RewriteCond %{QUERY_STRING} ^c=5$
RewriteRule ^/phpBB/(index\.php)?$ /community/viewforum.php?f=53 [R=301]
#RewriteCond %{QUERY_STRING} ^f=([0-9]){1,2}$
#RewriteRule ^/phpBB/viewforum\.php$ /community/viewforum.php?$1 [R=301,QSA]
#RewriteCond %{QUERY_STRING} ^t=([0-9])+$
#RewriteRule ^/phpBB/viewtopic\.php$ /community/viewtopic.php?$1 [R=301,QSA]
RewriteRule ^/phpBB/profile\.php(.*)$ /community/memberlist\.php$1 [R=301,L]
RewriteRule ^/phpBB/rules\.php$ /rules/ [R=301,L]
RewriteRule ^/phpBB/(.*)$ /community/$1 [R=301,L]
RewriteRule ^/support/documentation/3\.0/(.+)\.html$ /support/documentation/3.0/$1.php [R=301,L]
RewriteRule ^/support/guide/(.*)$ /community/viewtopic.php?f=14&t=1385785&n=$1 [R=301,L]
RewriteRule ^/support/documentation/2.0/(.*)$ /community/viewtopic.php?f=14&t=1385785&n=$1 [R=301,L]
RewriteRule ^/support/tutorials/2.0/(.*)$ /community/viewtopic.php?f=14&t=1385785&n=$1 [R=301,L]
RewriteRule ^/rss\.php$ /feeds/ [R=301,L]
RewriteRule ^/support/tutorials/(2\.0|3\.0) /support/tutorials/index.php?version=$1 [QSA]
RewriteCond %{IS_SUBREQ} !^true$
RewriteRule ^/kb/(2.0|3.0){1}/{0,1}$ /kb/index.php?v=$1 [QSA]
RewriteRule ^/kb/(category|2.0|3.0){1}/([^/]+)/{0,1}$ /kb/index.php?v=$1&c=$2 [QSA]
RewriteRule ^/kb/article/([^/]+)/{0,1}$ /kb/article.php?id=$1 [QSA]
RewriteRule ^/kb/submit/{0,1}$ /kb/submit.php [QSA]
RewriteRule ^/kb/moderate/{0,1}$ /kb/mcp.php [QSA]
RewriteRule ^/kb/categories.php$ /kb/article.php?article_id=10 [QSA]
RewriteCond %{QUERY_STRING} ^version=(all|blank)&cat=(all|blank)$
RewriteRule ^/support/docs/kb/ /support/docs/kb/? [R=301,L]
RewriteCond %{QUERY_STRING} ^version=(all|blank)&cat=([A-Za-z0-9\-]+)$
RewriteRule ^/support/docs/kb/ /support/docs/kb/%2/? [R=301,L]
RewriteCond %{QUERY_STRING} ^version=([A-Za-z0-9.]+)&cat=(all|blank)$
RewriteRule ^/support/docs/kb/ /support/docs/kb/%1/? [R=301,L]
RewriteCond %{QUERY_STRING} ^version=([A-Za-z0-9.]+)&cat=([A-Za-z0-9\-]+)$
RewriteRule ^/support/docs/kb/ /support/docs/kb/%1/%2/? [R=301,L]
RewriteCond %{IS_SUBREQ} !^true$
RewriteRule ^/support/docs/kb/article/([A-Za-z0-9\-]+)/rev/$ /support/docs/kb/article.php?slug=$1&rev=1 [QSA]
RewriteRule ^/support/docs/kb/article/([A-Za-z0-9\-]+)/$ /support/docs/kb/article.php?slug=$1 [QSA]
RewriteRule ^/support/docs/kb/edit/([A-Za-z0-9\-]+)/$ /support/docs/kb/submit.php?edit=$1 [QSA]
RewriteRule ^/support/docs/kb/redirect/$ /support/docs/kb/submit.php?new_redirect=1 [QSA]
RewriteRule ^/support/docs/kb/(submit|login)/$ /support/docs/kb/submit.php [QSA]
RewriteRule ^/support/docs/kb/([A-Za-z0-9\-.]+)/([A-Za-z0-9\-]+)/$ /support/docs/kb/index.php?var1=$1&var2=$2 [QSA]
RewriteRule ^/support/docs/kb/([A-Za-z0-9\-.]+)/$ /support/docs/kb/index.php?var1=$1 [QSA]
RewriteRule ^/support/docs/ug/([A-Za-z0-9\-_]+)/([A-Za-z0-9\-_]+)/$ /support/docs/ug/index.php?selected_tab=$1&selected_sec=$2 [QSA]
RewriteRule ^/support/docs/ug/([A-Za-z0-9\-_]+)/$ /support/docs/ug/index.php?selected_tab=$1 [QSA]
RewriteRule ^/(mods|styles)/db/download/([0-9]+)/{0,1} /$1/db/index.php?i=misc&mode=display&download=1&contrib_id=$2
RewriteRule ^/(mods|styles)/db/overview/([0-9]+)/{0,1} /$1/db/index.php?i=misc&mode=display&contrib_id=$2 [R=301,L]
RewriteRule ^/(mods|styles)/db/feeds/(atom|rss)/([a-z]+)/([0-9]+)/{0,1} /$1/db/index.php?i=browse&mode=feed&type=$2&opt=$3&contrib_id=$4
RewriteRule ^/(mods|styles)/db/feeds/(atom|rss)/([a-z]+)/{0,1} /$1/db/index.php?i=browse&mode=feed&type=$2&opt=$3
RewriteRule ^/mods/db/eal/([0-9]+)/([a-z0-9]+).(mod|zip) /mods/db/eal.php?id=$1&/$2
RewriteRule ^/styles/db/demo/([0-9]+)/demo.gif /styles/db/index.php?i=misc&contrib_id=$1&mode=display&demo=1

# Images
RewriteRule ^/shop/images/dsc01781\.jpg$ /files/etc/osuosl_red_bertie_and_friends.jpg [R=301,L]
RewriteRule ^/shop/images/dsc01782\.jpg$ /files/etc/osuosl_red_bertie_and_firefox.jpg [R=301,L]
RewriteRule ^/shop/images/dsc01783\.jpg$ /files/etc/osuosl_red_bertie_and_tux_etc.jpg [R=301,L]
RewriteRule ^/shop/images/dsc01784\.jpg$ /files/etc/osuosl_red_bertie_in_datacentre.jpg [R=301,L]
RewriteRule ^/shop/images/dsc01785\.jpg$ /files/etc/osuosl_red_bertie_with_phpbb_server.jpg [R=301,L]
RewriteRule ^/shop/images/dsc01786\.jpg$ /files/etc/osuosl_red_bertie_guards_the_rack.jpg [R=301,L]
RewriteRule ^/shop/images/dsc01787\.jpg$ /files/etc/osuosl_red_bertie_extreme_closeup.jpg [R=301,L]
RewriteRule ^/shop/images/Bertie_Mons\.jpg$ /files/etc/bertie_mons.jpg [R=301,L]
RewriteRule ^/shop/images/bertie_on_throne\.jpg$ /files/etc/bertie_on_throne.jpg [R=301,L]
RewriteRule ^/shop/images/Berties_boxed\.jpg$ /files/etc/red_berties_boxed.jpg [R=301,L]
RewriteRule ^/shop/images/Berties_on_Mars\.jpg$ /files/etc/red_berties_on_mars.jpg [R=301,L]
RewriteRule ^/shop/images/Bertie_visiting_countries\.gif$ /files/etc/red_bertie_visiting_countries.gif [R=301,L]
RewriteRule ^/shop/images/phpBB_Plush_Bear\.jpg$ /files/etc/version_one_bertie.jpg [R=301,L]
RewriteRule ^/shop/images/phpBB_Plush_Bear\.thumb\.jpg$ /files/etc/version_one_bertie.small.jpg [R=301,L]
RewriteRule ^/shop/images/RoyalMail-zones\.png$ /files/etc/red_bertie_royalmail_zones.png [R=301,L]
RewriteRule ^/community/images/smilies/icon_biggrin\.gif$ /community/images/smilies/icon_e_biggrin.gif [R=301,L]
RewriteRule ^/community/images/smilies/icon_confused\.gif$ /community/images/smilies/icon_e_confused.gif [R=301,L]
RewriteRule ^/community/images/smilies/icon_frown\.gif$ /community/images/smilies/icon_e_sad.gif [R=301,L]
RewriteRule ^/community/images/smilies/icon_sad\.gif$ /community/images/smilies/icon_e_sad.gif [R=301,L]
RewriteRule ^/community/images/smilies/icon_smile\.gif$ /community/images/smilies/icon_e_smile.gif [R=301,L]
RewriteRule ^/community/images/smilies/icon_surprised\.gif$ /community/images/smilies/icon_e_surprised.gif [R=301,L]
RewriteRule ^/community/images/smilies/icon_wink\.gif$ /community/images/smilies/icon_e_wink.gif [R=301,L]
